# TicTacToe API

REST API для игры в крестики-нолики с расширенными правилами и кастомизируемым полем. API позволяет создавать игры, делать ходы, отслеживать статус игры и проверять победителя.

## Логика игры

1. **Создание игры**: При создании игры нужно передать имена игроков. После этого создается игра с параметрами (размер поля и условия победы), которые задаются через переменные окружения. Это можно сделать в `appsettings.json` или в `docker-compose.yml`. Игра начинается с пустым полем.
2. **Ходы игроков**: Игроки по очереди делают ходы. Каждый ход содержит информацию о клетке на поле, куда игрок ставит свой символ.
3. **Условие победы**: Игра заканчивается победой одного из игроков или ничьей. Условие победы определяется заданной длиной линии победы.
4. **Рандомизация хода**: Каждые 3 хода существует вероятность, что текущий игрок сделает ход, поставив символ противника. Вероятность этого события — 10%.

## Технологический стек

- **Платформа**: .NET 9
- **Хранилище**: SQLite
- **ORM**: Entity Framework Core
- **Тестирование**: xUnit
- **Контейнеризация**: Docker

## Архитектурные решения

Архитектура приложения основана на слоистом подходе, который помогает разделить логику приложения на несколько слоев с четкими обязанностями. Каждый компонент (контроллер, сервис, репозиторий) имеет свою четко определенную роль, и каждый слой отвечает только за свою часть работы. Контроллеры не содержат бизнес-логики, которая находится в сервисах. Репозитории ответственны за взаимодействие с базой данных.

Все сервисы внедряются в контроллеры с помощью Dependency Injection. Это позволяет легко тестировать и заменять компоненты, а также уменьшает связанность компонентов, что делает код более гибким и поддерживаемым.

Для централизованной обработки исключений используется middleware, который перехватывает ошибки и возвращает клиенту корректный HTTP-ответ с детальной информацией о возникшей проблеме.

Для управления конкурентным доступом реализована оптимистичная блокировка через ETag. Каждая версия игры имеет уникальный ETag (хеш состояния), который отправляется клиенту в ответе на любой запрос к игре. Клиент должен отправлять текущий ETag в заголовке `If-Match`. При конфликте версий возвращается статус `409 Conflict`.

В API гарантируется идемпотентность для некоторых операций, например, при выполнении хода. Если два запроса с одинаковыми данными поступают одновременно, второй запрос вернет тот же результат, что и первый. В случае повторных запросов состояние игры останется неизменным.

## Инструкция по запуску

1. Склонируйте репозиторий.
2. Откройте терминал в корневой папке решения.
3. Выполните команду: **docker-compose up --build**

4. Перейдите по адресу [http://localhost:8080/health](http://localhost:8080/health), чтобы проверить работоспособность API.

В проекте используется **Swagger** для автоматической генерации и отображения документации. Swagger доступен по следующему адресу: [http://localhost:8080/swagger](http://localhost:8080/swagger). Там же можно будет увидеть описание API. С помощью Swagger можно узнать список всех эндпойнтов, параметры запросов и ответов, примеры запросов и ответов, документацию по возможным ошибкам. Также Swagger позволяет протестировать каждый эндпойнт API прямо из интерфейса.

### Краткий список всех эндпойнтов:

- **POST /games**: Создаёт новую игру.
- **POST /moves**: Отправляет ход для одного из игроков в указанной игре.
- **GET /games/{id}**: Получает информацию об игре по ID.
- **GET /health**: Проверка работоспособности API.

### Тестирование

Для тестирования перейдите в проект **TicTacToeAPI.Tests** и выполните команду: **dotnet test**

Это запустит все unit и интеграционные тесты для проверки функциональности API.
